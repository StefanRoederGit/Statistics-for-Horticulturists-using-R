---
title: "LICOR 6400XT"
author: "Stefan Roeder"
date: "7/1/2021"
output: rmarkdown::github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Background
We will use a fictional dataset.

Research question: Do scion and rootstock affect leaf gas exchange in apple?

Explanatory variables:
- rootstock (2 levels)
- scion (5 levels)

Response variables:
- Carbon dioxide assimilation rate (Photo)
- Transpiration rate (Trmmol)
- Conductance (Cond)

Experimental design:
- subsampling (two readings per tree)

Note:
- I will be using the emmeans package. Thus, the reported means are estimated marginal means. 

### Install and Load Required Packages

```{r, echo=TRUE, message=FALSE}
if (!require('nlme')) install.packages('nlme')
library('nlme')

if (!require('emmeans')) install.packages('emmeans')
library('emmeans')

if (!require('multcomp')) install.packages('multcomp')
library('multcomp')

if (!require('multcompView')) install.packages('multcompView')
library('multcompView')

if (!require('ggplot2')) install.packages('ggplot2')
library('ggplot2')

if (!require('ggpubr')) install.packages('ggpubr')
library('ggpubr')
```

### Import Dataset

```{r}
mydata <- read.delim(url("https://raw.githubusercontent.com/StefanRoederGit/Statistics-for-Horticulturists-using-R/main/LICOR6400XT/Dataset/LICOR-6400XT.txt"),stringsAsFactors=TRUE)
```

### Convert to Factor Variables

```{r, echo=TRUE}
mydata$Rootstock <- as.factor(mydata$Rootstock)
mydata$Scion <- as.factor(mydata$Scion)
mydata$Tree <- as.factor(mydata$Tree)
```

### Fit Linear Mixed Model, Run ANOVA, and Perform Multiple Comparision Procedure 
#### CO2 Assimilation Rate (Photo)

```{r, echo=TRUE}
fit <- lme(Photo ~ Rootstock * Scion, data = mydata, random = ~1|Tree)
anova(fit)
```


There were significant differences in carbon dioxide assimilation rate between the two rootstocks (F(1,27) = 14.9, P = 0.0006) and five scion cultivars (F(1,27) = 5.4, P = 0.0026). 


```{r, message=FALSE}
lm.emmGrid <- emmeans(fit, pairwise ~ Rootstock)
cld(lm.emmGrid[[1]], Letters = letters)
```


The average assimilation rate of G.11 (mean = 15.3 μmol m−2 s−1) was significant lower when compared to G.41 (mean = 18.3 μmol m−2 s−1).


```{r, message=FALSE}
lm.emmGrid <- emmeans(fit, pairwise ~ Scion)
cld(lm.emmGrid[[1]], Letters = letters)
```


Furthermore, 'Granny Smith' showed with 19.7 μmol m−2 s−1 significantly higher assimilation rates than 'Red Delicious' (mean = 14.6 μmol m−2 s−1) and 'Fuji' (mean = 15.8 μmol m−2 s−1). The assimilation rate of 'Golden Delicious' (mean = 16.3 μmol m−2 s−1) and 'Gala' (17.7 μmol m−2 s−1) did not differ from 'Red Delicious', 'Fuji', and 'Granny Smith'.


#### Plot Data (emmeans +/- 95% confidence intervals)

```{r, message=FALSE}
lm.emmGrid <- emmeans(fit, pairwise ~ Rootstock)
clddata <- cld(lm.emmGrid[[1]], Letters = letters)

ggplot(clddata, aes(x = Rootstock, y = emmean, fill = Rootstock)) +
  geom_bar(stat="identity", position = position_dodge()) +
  geom_errorbar(aes(ymin = lower.CL, ymax = upper.CL), width = 0.1, position=position_dodge(.9)) +
  theme_bw(base_size = 14) +
  ggtitle("Main Effect: Rootstock") +
  xlab("Cultivar") +
  ylab(~paste("Assimilation rate (", mu, "mol CO"[2], " m"^-2,"s"^-1,")"))+
  ylim(0,25) +
  scale_y_continuous(expand = expansion(mult = c(0, .1))) +
  geom_text(data = clddata, aes(y= upper.CL + 1, label = .group),  size = 6) +
  theme(legend.position = "none")  
```

```{r, message=FALSE}
lm.emmGrid <- emmeans(fit, pairwise ~ Scion)
clddata <- cld(lm.emmGrid[[1]], Letters = letters)

ggplot(clddata, aes(x = Scion, y = emmean, fill = Scion)) +
  geom_bar(stat="identity", position = position_dodge()) +
  geom_errorbar(aes(ymin = lower.CL, ymax = upper.CL), width = 0.1, position=position_dodge(.9)) +
  theme_bw(base_size = 14) +
  ggtitle("Main Effect: Scion") +
  xlab("Cultivar") +
  ylab(~paste("Assimilation rate (", mu, "mol CO"[2], " m"^-2,"s"^-1,")")) +
  ylim(0,25) +
  scale_y_continuous(expand = expansion(mult = c(0, .1))) +
  geom_text(data = clddata, aes(y= upper.CL + 1, label = .group),  size = 6) +
  theme(legend.position = "none")  
```

